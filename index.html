<html>
<head>
    <title>КРОК тесты</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="КРОК тесты">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <link rel="icon" type="image/png" href="favicon.png" />
    <link href="icon114px.png" sizes="114x114" rel="apple-touch-icon-precomposed">

    <link rel="stylesheet" href="style.css">
    <script type="text/javascript" src="jquery.js" ></script>
    <script type="text/javascript" src="core.js" ></script>
</head>
<body>
<table id="results-table">
    <tr>
        <td>
            <div id="result-emo" class="emo one-row"></div>
            <div class="one-row score-percent">0%</div>
            <div class="one-row result-stats">
                <div>
                    <span>Правильно: </span>
                    <span id="results-score-correct" class="correct">0</span>
                </div>
                <div>
                    <span>Ошибок: </span>
                    <span id="results-score-wrong" class="wrong">0</span>
                </div>
                <div>
                    <span>Подсмотрено: </span>
                    <span id="results-score-forgot" class="forgot">0</span>
                </div>
            </div>
            <div class="one-row">
                <button class="concrete-flat-button sbtn-exit">Выйти</button>
            </div>
        </td>
    </tr>
</table>
<table id="start-table">
    <tr>
        <td><div class="logo"></div></td>
    </tr>
    <tr>
        <td>
            <p>Сценарий тестирования</p>
            <br>
            <select id="test-list"></select>
        </td>
    </tr>
    <tr>
        <td class="centered"><button id="sbtn-begin" class="amethyst-flat-button">Начать</button></td>
    </tr>
</table>
<table id="question-table">
    <thead>
    <tr>
        <th>
            <div class="emo" id="main-emo">
            </div>
            <div class="top-block">
                <div class="block-stats">
                    <b>Верно:</b>
                    <b id="score-correct">0</b>
                    <b>Ошибок:</b>
                    <b id="score-wrong">0</b>
                    <b>Подсказок:</b>
                    <b id="score-forgot">0</b>
                    <b class="overall" id="score-overall">0/0</b>
                </div>
                <div id="block-question"></div>
            </div>
        </th>
    </tr>
    </thead>
    <tbody id="block-answers">
    </tbody>
    <tfoot>
    <tr>
        <td class="centered button-block" id="control-bar">
            <button class="concrete-flat-button " id="sbtn-iforgot">Я не помню</button>
            <button class="concrete-flat-button sbtn-exit">Выйти</button>
            <button class="sbtn-answer turquoise-flat-button" id="sbtn-answer">Ответить</button>
            <div class="block-arrows">
                <button id="sbtn-prev" class="arrow belize-hole-flat-button"><</button>
                <button id="sbtn-next" class="arrow belize-hole-flat-button">></button>
            </div>
            <div class="block-arrows">
            </div>
        </td>
        <td class="centered button-block" id="next-bar">
            <button class="sbtn-answer turquoise-flat-button">Дальше</button>
        </td>
    </tr>
    </tfoot>
</table>
<script>
    $( window ).load(function() {

        $(document).on('click', '#question-table .sbl-answer', function() {
            $(this).toggleClass('selected-answer');
        })

        $('.sbtn-exit').on('click', function() {
            if(window.confirm("Бросить тест и выйти?")) {
                $('#start-table').show();
                $('#question-table').hide();
                $('#results-table').hide();
            }
        });

        $('#next-bar').on('click', function() {
            $('#question-table').removeClass('opacity-answers');
            $('body').removeClass('correct-answer wrong-answer');
            $('.emo').addClass('emo-think').removeClass('emo-right emo-wrong');
            $('#rays').remove();
            $('#next-bar').hide();
            $('#control-bar').show();
            window.test.move(null);
        });


        $('#sbtn-next').on('click', {goNext: true}, function() {window.test.move();});
        $('#sbtn-prev').on('click', {goNext: false}, function() {window.test.move();});
        $('#sbtn-answer').on('click', function() {window.test.answer();})

        $('#sbtn-iforgot').on('click', function () {
            $('.sbl-answer').each(function(a) {
                if ($(this).attr('correct') == 1) {
                    $(this).append('<div class="emo emo-right emo-forgot"></div>');
                    $(this).addClass('forgot-correct');
                }
            });
            window.test.update({forgot:1});
        });

        var testList = [
              ['_ЗАОЧ_КРОК1 Пробное тестирование - 2016', null],
              ['_ЗАОЧ_КРОК1_Физ. химия (обучение)', 'fiz_himia'],
              ['_ЗАОЧ_КРОК1_Фармакология (обучение)', 'farmakologia'],
              ['_ЗАОЧ_КРОК1_Пат. физиология (обучение)', 'pat_fiziologia'],
              ['_ЗАОЧ_КРОК1_Органич. химия (обучение)', 'organich_himia'],
              ['_ЗАОЧ_КРОК1_Микробиология (обучение)', 'mikrobiologia'],
              ['_ЗАОЧ_КРОК1_Ботаника (обучение)', 'botanika'],
              ['_ЗАОЧ_КРОК1_Биохимия (обучение)', 'biohimia'],
              ['_ЗАОЧ_КРОК1_Аналитич. химия (обучение)', 'analit_himia']];

        var jsons = [];

        function fetchJson(name, iter) {
            $.getJSON(name, function( data ) {
                jsons[iter] = data;
            });
        }

        var options = '';
        for(var i in testList) {
            options += '<option value="'+i+'">'+testList[i][0]+'</option>';
            if (testList[i][1] != null) fetchJson(testList[i][1] + ".json", i);
        }
        $('#test-list').append(options);

        $('#sbtn-begin').on('click', function () {
            window.test = new Test(jsons);
            window.test.startTest();
        });
    });
</script>
</body>
</html>